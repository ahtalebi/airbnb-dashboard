<div class="dashboard-container">
  <header>
    <h1>üè† Berlin Airbnb Analytics Dashboard</h1>
    <p>Explore and analyze Airbnb listings in Berlin</p>
  </header>

  <div *ngIf="loading" class="loading">
    <p>Loading Airbnb data...</p>
  </div>

  <div *ngIf="!loading">
    
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">{{ totalListings | number }}</div>
        <div class="stat-label">Total Listings</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">‚Ç¨{{ avgPrice }}</div>
        <div class="stat-label">Average Price/Night</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ avgRating }}</div>
        <div class="stat-label">Average Rating</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ superhostCount | number }}</div>
        <div class="stat-label">Superhosts</div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filter-group">
        <label for="neighbourhoodSelect">Neighbourhood:</label>
        <select 
          id="neighbourhoodSelect" 
          [(ngModel)]="selectedNeighbourhood" 
          (change)="onFilterChange()">
          <option value="">All Neighbourhoods</option>
          <option *ngFor="let neighbourhood of neighbourhoods" [value]="neighbourhood">
            {{ neighbourhood }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="roomTypeSelect">Room Type:</label>
        <select 
          id="roomTypeSelect" 
          [(ngModel)]="selectedRoomType" 
          (change)="onFilterChange()">
          <option value="">All Types</option>
          <option *ngFor="let type of roomTypes" [value]="type">
            {{ type }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="maxPriceSlider">Max Price: ‚Ç¨{{ maxPrice }}</label>
        <input 
          type="range" 
          id="maxPriceSlider"
          [(ngModel)]="maxPrice"
          (change)="onFilterChange()"
          min="20"
          max="1000"
          step="10"
          class="price-slider">
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <canvas id="priceChart"></canvas>
      </div>

      <div class="chart-container">
        <canvas id="roomTypeChart"></canvas>
      </div>

      <div class="chart-container">
        <canvas id="neighbourhoodChart"></canvas>
      </div>

      <div class="chart-container">
        <canvas id="ratingChart"></canvas>
      </div>
    </div>

    <!-- Data Table Section -->
    <div class="table-section">
      <h2>Listings ({{ filteredData.length }} results)</h2>
      
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Host</th>
              <th>Neighbourhood</th>
              <th>Room Type</th>
              <th>Price</th>
              <th>Bedrooms</th>
              <th>Reviews</th>
              <th>Rating</th>
              <th>Superhost</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredData.slice(0, 100)">
              <td class="listing-name">{{ item.name }}</td>
              <td>{{ item.host_name }}</td>
              <td>{{ item.neighbourhood_cleansed }}</td>
              <td>{{ item.room_type }}</td>
              <td class="price">‚Ç¨{{ item.price }}</td>
              <td>{{ item.bedrooms || 'N/A' }}</td>
              <td>{{ item.number_of_reviews }}</td>
              <td>{{ item.review_scores_rating || 'N/A' }}</td>
              <td>
                <span *ngIf="item.host_is_superhost === 't'" class="badge superhost">‚≠ê</span>
                <span *ngIf="item.host_is_superhost !== 't'" class="badge">-</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <p *ngIf="filteredData.length > 100" class="table-note">
        Showing first 100 of {{ filteredData.length }} results
      </p>
    </div>
  </div>
</div>
